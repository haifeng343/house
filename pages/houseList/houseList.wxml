<wxs src="../../utils/filter.wxs" module="filter" />
<view>
  <view class="header {{!scrollIng ? '' : ''}}">
    <view class="top-nav'">
      <houseSelect id="houseSelect" type='house' checkInDate="{{checkInDate}}" checkOutDate="{{checkOutDate}}" cityName="{{cityName}}" locationName="{{locationName}}" bind:clickSelectItem='clickSelectItem'></houseSelect>
      <view class="bg_border"></view>
    </view>
    <view wx:if="{{countFlag === 1}}" class="house_detail">
      <view>总计:{{allCount}}套</view>
      <view>最低价:¥{{lowPrice}}</view>
      <view class="check_detail" bindtap="goToDetail">
        <text>查看明细</text>
        <image class="check_more" src="../../assets/image/more.png"></image>
      </view>
    </view>
  </view>
  <view class="block"></view>
  <view class="card-list {{countFlag === 0||countFlag === 2 ? 'section_empty' : ''}}">
    <view class="search_empty" wx:if="{{countFlag === 0}}">
      <view class="search_view">
        <image class="empty_image" src="../../assets/image/search_empty.png"></image>
      </view>
      <view class="search_view search_title">未找到符合条件的房源</view>
      <view class="search_view search_tip">立即添加监控，第一时间推送房源信息，再也不怕心仪的房源擦肩而过</view>
    </view>
    <view  class="search_empty" wx:if="{{countFlag === 2}}">
      <noNetwork title="网络异常，请刷新重试"></noNetwork>
    </view>
    <block wx:for="{{allData}}" wx:key="{{idx}}" wx:for-index="idx">
      <view class="house_card" data-productId="{{item.productId}}" data-platform="{{item.platformId}}" catchtap="goToPlatformDetail">
        <swiper class="swiper" data-Index="{{idx}}" bindchange="swiperChange">
          <block wx:for="{{item.pictureList}}" wx:key="{{index}}" wx:for-item="items">
            <swiper-item wx:if="{{item.platformId == 'xz'}}">
              <imageExtend src="{{filter.xzCoverImage(items)}}" data-index="{{index}}" data-idx="{{idx}}"></imageExtend>
            </swiper-item>
            <swiper-item wx:else>
              <imageExtend src="{{items}}" data-index="{{index}}" data-idx="{{idx}}"></imageExtend>
            </swiper-item>
          </block>
        </swiper>
        <image class="star" wx:if="{{item.collection}}" data-collection="{{item.collection}}" data-Index="{{idx}}" data-productId="{{item.productId}}" catchtap="goToCollection" src="../../assets/image/star_select.png"></image>
        <image class="star" wx:else data-Index="{{idx}}" data-collection="{{item.collection}}" data-productId="{{item.productId}}" catchtap="goToCollection" src="../../assets/image/star.png"></image>
        <view class="house_classify" wx:if="{{item.platformId == 'tj'}}">途家</view>
        <view class="house_classify" wx:elif="{{item.platformId == 'xz'}}">小猪</view>
        <view class="house_classify" wx:elif="{{item.platformId == 'mn'}}">木鸟</view>
        <view class="house_classify" wx:else="{{item.platformId == 'zg'}}">榛果</view>
        <!-- <view class="house_swiper">{{item.curIndex}}/{{item.pictureList.length}}</view> -->
        <view class="house_price">
          <text>¥{{item.finalPrice}}/晚{{dayCount==1?'':'(均价)'}}</text>
          <view class="triangle"></view>
        </view>
        <view class="house_bottom">
          <view class="house_message">
            <view class="house_name">
              <image class="hotel" src="../../assets/image/hotel.png"></image>
              <text>{{item.unitName}}</text>
            </view>
            <view class="house_type">
              <text>{{item.preloadDetail}}</text>
            </view>
            <view class="house_tag {{item.priceTag&&item.priceTag.length>0?'':'house_tag_none'}}">
              <block wx:for="{{item.priceTag}}" wx:for-index="i" wx:for-item="pitem" wx:key="{{i}}">
                <text wx:if="{{item.platformId == 'tj'}}">{{pitem.text}}</text>
                <text wx:if="{{item.platformId == 'xz'}}">{{pitem.title}}</text>
                <text wx:if="{{item.platformId == 'zg'}}">{{pitem.tagName}}</text>
              </block>
              <text class="discount" wx:if="{{item.discount}}">{{item.discount}}</text>
            </view>
          </view>
          <view class="house_photo">
            <image class="photo" src="{{item.logoUrl}}"></image>
          </view>
        </view>
      </view>
    </block>
    <view class="no-more-data" wx:if="{{allData.length&&allData.length==allOriginalData.length&&!loadingShow}}">
      <text wx:if="{{allData.length<50}}">房源已加载完，若不满意你试试添加监控</text>
      <text wx:else>已展示全部房源</text>
    </view>
    <mp-loading type="dot-red" tips="加载中" show="{{loadingShow}}"></mp-loading>
  </view>
  <view class="house_monitor" wx:if="{{loadingDisplay == 'none'}}">
    <button wx:if="{{countFlag ===1 &&allCount>=50}}" class="monitor_btn" bindtap='startMonitor'>查看更多</button>
    <button wx:if="{{(countFlag ===1 &&allCount<50)||countFlag == 0}}" class="monitor_btn" bindtap='startMonitor'>开启监控</button>
    <button wx:if="{{countFlag ===2}}"class="monitor_btn" bindtap='goRefresh'>立即刷新</button>
  </view>
  <view wx:if="{{countFlag === 1}}" class="house_shortcuts {{!scrollIng ? '' : 'hidden'}}">
    <view>
      <image bindtap="goTop" wx:if="{{scrollTop>500}}" class="top" src="../../assets/image/top.png"></image>
    </view>
    <view>
      <image bindtap="goSort" class="sort" src="../../assets/image/sort.png"></image>
    </view>
  </view>

  
  <view class="house_loading" style="display:{{loadingDisplay}}" catchtouchmove="preventTouchMove">
    <image src="../../assets/image/loading.gif"></image>
  </view>
  <enoughDialog title="{{'已帮您甄选'+allOriginalData.length+'套房源，若想查看更多房源，请点击前往各平台查看'}}" list="{{enoughList}}"  bind:enoughEvent="getEnoughEvent" style="display:{{enoughDisplay}}"></enoughDialog>
  <enoughBottomDialog title="您已查看全部房源，更多房源可前往各平台查看" list="{{enoughList}}" bind:enoughBottomEvent="getBottomEnoughEvent" style="display:{{enoughBottomDisplay}}"></enoughBottomDialog>
  <collectDialog bind:collectEvent="getcollectEventEvent" style="display:{{collectDisplay}}"></collectDialog>
  <monitorDialog ddCoin="{{ddCoin}}" bindPublic="{{bindPublic}}" bind:monitorPublicEvent="getMonitorPublicEvent" bind:monitorEvent="getMonitorEvent" bind:monitorConfirmEvent="getmonitorConfirmEvent" style="display:{{monitorDisplay}}"></monitorDialog>
  <monitorBottomDialog ddCoin="{{ddCoin}}" bind:monitorrBottomPublicEvent="getMonitorrBottomPublicEvent" bindPublic="{{bindPublic}}" bind:monitorBottomEvent="getMonitorBottomEvent" bind:monitorBottomConfirmEvent="getmonitorBottomConfirmEvent" style="display:{{monitorBottomDisplay}}"></monitorBottomDialog>
  <advanceFilter class='{{showAdvance?"":"vhidden"}}' shownType='{{showAdvanceType}}' cityName='{{cityName}}' bind:submit='submitAdvance' />
  <publicDialog style="display:{{publicDisplay}}" bind:publicEvent="getPublicEvent" bind:publicConfrimEvent="getPublicConfrimEvent"></publicDialog>
</view>